<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TYPER - NEON TUBE [CONTROLS]</title>
    <style>
        /* =========================================
           CORE STYLES
           ========================================= */
        :root {
            --bg-color: #050505;
            --text-main: #b0b0b0;
            --text-dim: #666666;
            --tube-green: #33ff33;
            --tube-glow: 0 0 2px #33ff33, 0 0 8px rgba(51, 255, 51, 0.6), 0 0 15px rgba(51, 255, 51, 0.2);
            --panel-bg: rgba(5, 5, 5, 0.95);
            --font-stack: "Menlo", "Monaco", "Consolas", "Courier New", monospace;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: var(--bg-color); color: var(--text-main);
            font-family: var(--font-stack); font-size: 14px;
            overflow: hidden; user-select: none;
        }

        #visual-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; opacity: 0.8;
        }

        #terminal-ui {
            position: relative; z-index: 10; width: 100%; height: 100%;
            padding: 20px; box-sizing: border-box;
            display: flex; flex-direction: column;
            pointer-events: none; 
        }

        .neon-text {
            color: var(--tube-green);
            text-shadow: var(--tube-glow);
            font-weight: bold; letter-spacing: 1px;
        }
        
        .header-info {
            pointer-events: auto; white-space: pre-wrap;
            margin-bottom: 10px; color: var(--text-dim);
            border-bottom: 1px dashed #333; padding-bottom: 10px;
            display: flex; justify-content: space-between; flex-shrink: 0;
        }

        #sys-trigger {
            cursor: pointer; color: var(--text-dim);
            border: 1px solid #444; padding: 2px 8px;
            display: none; font-size: 12px;
            z-index: 2000; transition: all 0.2s;
        }
        #sys-trigger:hover { 
            color: var(--tube-green); border-color: var(--tube-green);
            text-shadow: var(--tube-glow);
        }

        #terminal-history {
            flex-grow: 1; display: flex; flex-direction: column;
            justify-content: flex-end; padding-bottom: 15px;
            pointer-events: auto;
            transition: opacity 0.5s ease; 
            overflow-y: auto; min-height: 0; scrollbar-width: none;
        }
        #terminal-history::-webkit-scrollbar { display: none; }
        #terminal-history.dimmed { opacity: 0.1; filter: blur(1px); }

        .log-entry { margin-bottom: 4px; white-space: pre-wrap; word-break: break-all; }
        .sys { color: var(--text-dim); } 
        .success { color: var(--tube-green); text-shadow: 0 0 5px rgba(51, 255, 51, 0.4); } 
        .warn { color: #ff3333; text-shadow: 0 0 5px rgba(255, 51, 51, 0.4); }

        .input-area {
            display: flex; align-items: center; 
            border-top: 1px solid rgba(255,255,255,0.05);
            padding-top: 15px; background: transparent; 
            pointer-events: auto; flex-shrink: 0; 
            position: relative; z-index: 10001; 
        }
        
        .prompt { margin-right: 10px; }
        
        #cmd-input {
            flex-grow: 1; background: transparent; border: none;
            color: #fff; font-family: inherit; font-size: 16px; outline: none;
            text-shadow: 0 0 2px rgba(255,255,255,0.5);
        }
        #file-input { display: none; }

        /* === 视觉面板样式 === */
        #control-panel {
            position: absolute; top: 60px; right: 20px;
            width: 400px; max-height: calc(100% - 100px); 
            overflow-y: auto; background: var(--panel-bg); 
            border: 1px solid #333; padding: 15px; display: none; 
            z-index: 9999; box-shadow: 0 0 40px rgba(0,0,0,0.8);
            pointer-events: auto; font-family: var(--font-stack);
        }
        #control-panel::-webkit-scrollbar { width: 3px; }
        #control-panel::-webkit-scrollbar-track { background: #000; }
        #control-panel::-webkit-scrollbar-thumb { background: #333; }

        .panel-header {
            border-bottom: 1px solid #333; padding-bottom: 5px;
            margin-bottom: 10px; color: #888;
            position: sticky; top: 0; background: var(--panel-bg); z-index: 1;
            display: flex; justify-content: space-between;
        }
        .close-btn { cursor: pointer; color: #555; }
        .close-btn:hover { color: #fff; }

        .module-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }

        .module-btn {
            border: 1px solid #222; padding: 6px 10px; cursor: pointer;
            font-size: 11px; color: #777; transition: all 0.1s; text-align: left;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            background: rgba(0,0,0,0.3);
        }
        .module-btn:hover { border-color: #555; color: #ccc; }
        .module-btn.active { 
            background: rgba(0, 30, 0, 0.8); 
            color: var(--tube-green); border-color: var(--tube-green);
            text-shadow: var(--tube-glow);
            box-shadow: inset 0 0 10px rgba(51, 255, 51, 0.1);
        }

        /* === 新增：Playbar 样式 === */
        #audio-controls {
            position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
            width: 500px; background: var(--panel-bg);
            border: 1px solid #333; padding: 10px 15px;
            display: none; z-index: 10000;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            pointer-events: auto; font-family: var(--font-stack);
        }
        #audio-controls.active { display: block; border-color: #555; }
        
        .ac-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .track-title { color: var(--tube-green); font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 350px; }
        
        .progress-container {
            width: 100%; height: 6px; background: #222;
            cursor: pointer; position: relative; margin-bottom: 8px;
        }
        .progress-bar {
            height: 100%; width: 0%; background: var(--tube-green);
            box-shadow: var(--tube-glow); pointer-events: none;
        }
        
        .ctrl-btns { display: flex; gap: 10px; }
        .c-btn {
            background: transparent; border: 1px solid #444; color: #888;
            cursor: pointer; padding: 2px 8px; font-family: inherit; font-size: 12px;
        }
        .c-btn:hover { border-color: var(--tube-green); color: #fff; text-shadow: var(--tube-glow); }
        .time-disp { font-size: 11px; color: #666; font-family: monospace; }

        .hint-text {
            position: absolute; bottom: 10px; right: 20px;
            color: #333; font-size: 10px; pointer-events: none;
            z-index: 5;
        }
        #terminal-ui.hidden { opacity: 0; }
    </style>
</head>
<body>

<canvas id="visual-canvas"></canvas>

<div id="terminal-ui">
    <div class="header-info">
        <div><span class="neon-text">TYPER</span> OMNI [v51.5 TUBE]</div>
        <div id="sys-trigger">[ OPEN PANEL ]</div>
    </div>

    <div id="terminal-history"></div>
    
    <div id="audio-controls">
        <div class="ac-row">
            <span class="track-title" id="ac-title">NO MEDIA</span>
            <span class="close-btn" onclick="togglePlaybar()">×</span>
        </div>
        <div class="progress-container" id="ac-prog-bg">
            <div class="progress-bar" id="ac-prog-fill"></div>
        </div>
        <div class="ac-row">
            <span class="time-disp" id="ac-time">00:00 / 00:00</span>
            <div class="ctrl-btns">
                <button class="c-btn" onclick="prevTrack()">|&lt;</button>
                <button class="c-btn" id="btn-play" onclick="togglePlay()">PLAY</button>
                <button class="c-btn" onclick="playNext()">&gt;|</button>
            </div>
        </div>
    </div>

    <div class="input-area" id="input-container">
        <span class="prompt neon-text">CMD&gt;</span>
        <input type="text" id="cmd-input" autocomplete="off" spellcheck="false" autofocus>
    </div>
</div>

<div class="hint-text">[TAB] HIDE UI</div>

<div id="control-panel">
    <div class="panel-header">
        <span>VISUAL MODULES</span>
        <span class="close-btn" onclick="togglePanel()">×</span>
    </div>
    <div class="module-grid" id="module-grid"></div>
</div>

<input type="file" id="file-input" multiple accept="audio/*">

<script>
    // --- STATE ---
    const STATE = { mode: 0, isPlaying: false, playlist: [], trackIndex: 0 };
    
    // --- MODES (FILTERED LIST) ---
    const MODES = [
        { id: 0, name: "SPECTRUM BARS", desc: "Standard freq analysis" },
        { id: 1, name: "OSCILLOSCOPE", desc: "Raw waveform" },
        { id: 2, name: "RADAR SCAN", desc: "Polar map" },
        { id: 6, name: "HEX DUMP", desc: "Memory monitor" },
        { id: 9, name: "GLITCH", desc: "Signal corruption" },
        { id: 10, name: "SEISMOGRAPH", desc: "Amplitude log" },
        { id: 13, name: "COMPASS", desc: "Directional vector" },
        { id: 14, name: "BARCODE", desc: "Data density" },
        { id: 15, name: "TERMINAL", desc: "Code execution" },
        { id: 16, name: "HEATMAP", desc: "Thermal grid" },
        { id: 17, name: "VOICEPRINT", desc: "Biometric ID" },
        { id: 49, name: "EQUALIZER RINGS", desc: "Concentric circular EQ" }
    ];

    const DOM = {
        cvs: document.getElementById('visual-canvas'),
        ctx: document.getElementById('visual-canvas').getContext('2d'),
        ui: document.getElementById('terminal-ui'),
        history: document.getElementById('terminal-history'),
        inputCont: document.getElementById('input-container'),
        input: document.getElementById('cmd-input'),
        trigger: document.getElementById('sys-trigger'),
        panel: document.getElementById('control-panel'),
        grid: document.getElementById('module-grid'),
        // Controls
        playbar: document.getElementById('audio-controls'),
        acTitle: document.getElementById('ac-title'),
        acTime: document.getElementById('ac-time'),
        acFill: document.getElementById('ac-prog-fill'),
        acBg: document.getElementById('ac-prog-bg'),
        btnPlay: document.getElementById('btn-play')
    };

    // --- AUDIO & RENDER ENGINE ---
    let audioCtx, analyser, source, audioEl, dataArray, bufferLength;
    function initAudio() {
        if (audioCtx) return;
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        audioCtx = new AudioContext();
        audioEl = new Audio(); audioEl.crossOrigin = "anonymous";
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 512; analyser.smoothingTimeConstant = 0.85;
        const gain = audioCtx.createGain(); gain.gain.value = 0.5;
        source = audioCtx.createMediaElementSource(audioEl);
        source.connect(analyser); analyser.connect(gain); gain.connect(audioCtx.destination);
        bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        
        // Audio Listeners for UI
        audioEl.addEventListener('ended', () => playNext());
        audioEl.addEventListener('timeupdate', updateProgress);
        audioEl.addEventListener('loadedmetadata', updateProgress);
    }

    function resize() { DOM.cvs.width = window.innerWidth; DOM.cvs.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();
    const map = (val, s1, e1, s2, e2) => (val - s1) * (e2 - s2) / (e1 - s1) + s2;
    const toRad = (deg) => deg * Math.PI / 180;

    // --- PLAYBAR LOGIC ---
    function togglePlaybar() {
        const d = DOM.playbar.style.display;
        DOM.playbar.style.display = (d === 'block') ? 'none' : 'block';
        return (d === 'block') ? "Playbar hidden." : "Playbar initialized.";
    }

    function formatTime(s) {
        if(isNaN(s)) return "00:00";
        const m = Math.floor(s / 60);
        const sec = Math.floor(s % 60);
        return `${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
    }

    function updateProgress() {
        if(!audioEl) return;
        const curr = audioEl.currentTime;
        const dur = audioEl.duration || 0;
        const pct = dur > 0 ? (curr / dur) * 100 : 0;
        
        DOM.acFill.style.width = `${pct}%`;
        DOM.acTime.textContent = `${formatTime(curr)} / ${formatTime(dur)}`;
    }

    function togglePlay() {
        if(!audioEl) return;
        if(audioEl.paused) {
            audioEl.play(); STATE.isPlaying = true;
            DOM.btnPlay.textContent = "PAUSE";
            DOM.btnPlay.style.color = "var(--tube-green)";
        } else {
            audioEl.pause(); STATE.isPlaying = false;
            DOM.btnPlay.textContent = "PLAY";
            DOM.btnPlay.style.color = "#888";
        }
    }
    
    // Seek functionality
    DOM.acBg.addEventListener('click', (e) => {
        if(!audioEl) return;
        const rect = DOM.acBg.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const pct = x / rect.width;
        if(audioEl.duration) {
            audioEl.currentTime = pct * audioEl.duration;
        }
    });

    // --- MAIN RENDER LOOP ---
    function render() {
        requestAnimationFrame(render);
        const ctx = DOM.ctx; const w = DOM.cvs.width; const h = DOM.cvs.height;
        if (![3, 36, 37].includes(STATE.mode)) { ctx.fillStyle = "rgba(5,5,5,0.7)"; ctx.fillRect(0, 0, w, h); }
        ctx.font = "14px monospace"; ctx.textBaseline = "top";
        let bass = 0;
        if (analyser && STATE.isPlaying) {
            analyser.getByteFrequencyData(dataArray);
            let bVal = 0; for(let i=0; i<15; i++) bVal += dataArray[i];
            bass = bVal / 15 / 255;
        }

        switch(STATE.mode) {
             case 0: drawSpectrum(ctx, w, h); break; case 1: drawOscilloscope(ctx, w, h); break; case 2: drawRadar(ctx, w, h, bass); break;
             case 3: drawBinaryRain(ctx, w, h, bass); break;
             case 6: drawHexDump(ctx, w, h); break;
             case 9: drawGlitch(ctx, w, h, bass); break; case 10: drawSeismograph(ctx, w, h); break;
             case 13: drawCompass(ctx, w, h, bass); break; case 14: drawBarcode(ctx, w, h); break;
             case 15: drawTerminal(ctx, w, h); break; case 16: drawHeatmap(ctx, w, h, bass); break; case 17: drawVoiceprint(ctx, w, h, bass); break;
             case 49: drawEQRings(ctx, w, h, bass); break;
        }
    }

    // --- DRAW FUNCTIONS ---
    function drawSpectrum(ctx,w,h){const bars=64,step=Math.floor(bufferLength/bars),barW=w/bars;for(let i=0;i<bars;i++){const val=dataArray?dataArray[i*step]:0,pct=val/255,ht=pct*h*0.8,cc=Math.floor(ht/16);for(let j=0;j<cc;j++){ctx.fillStyle=j>h/16*0.6?"#ff3333":"#00ffcc";ctx.fillText(j%2===0?"█":"▓",i*barW,h-(j*16));}}}
    function drawOscilloscope(ctx,w,h){if(!analyser)return;const td=new Uint8Array(bufferLength);analyser.getByteTimeDomainData(td);ctx.fillStyle="#00ffcc";const sw=w*1.0/bufferLength;let x=0;for(let i=0;i<bufferLength;i++){const v=td[i]/128.0,y=v*h/2,c=v>1.05?"^":v<0.95?"v":"-";ctx.fillText(c,x,y);x+=sw;}}
    function drawRadar(ctx,w,h,bass){const cx=w/2,cy=h/2,r=Math.min(w,h)/3,t=Date.now()*0.002;ctx.strokeStyle="#00ffcc";ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(cx+Math.cos(t)*w,cy+Math.sin(t)*w);ctx.stroke();const cnt=30,step=Math.floor(bufferLength/cnt);for(let i=0;i<cnt;i++){const val=dataArray?dataArray[i*step]:0;if(val>100){const a=map(i,0,cnt,0,Math.PI*2),rad=map(val,0,255,0,r),tx=cx+Math.cos(a)*rad,ty=cy+Math.sin(a)*rad;ctx.fillStyle=val>200?"#ff3333":"#00ffcc";ctx.fillText(val>200?"TGT":"+",tx,ty);}}}
    let drops=[];function drawBinaryRain(ctx,w,h,bass){ctx.fillStyle="rgba(5,5,5,0.2)";ctx.fillRect(0,0,w,h);const cols=Math.floor(w/10);if(drops.length!==cols)drops=new Array(cols).fill(0);ctx.fillStyle="#0f0";for(let i=0;i<cols;i++){const c=Math.random()>0.5?"1":"0",val=dataArray?dataArray[i%bufferLength]:0,spd=val>128?2:1;ctx.fillStyle=`rgba(0,255,0,${val/255})`;ctx.fillText(c,i*10,drops[i]*16);if(drops[i]*16>h&&Math.random()>0.975)drops[i]=0;drops[i]+=spd+(bass*2);}}
    function drawHexDump(ctx,w,h){let idx=0;for(let y=0;y<h/16;y++){let l=`0x${(y*16).toString(16).padStart(4,'0').toUpperCase()}: `;for(let x=0;x<16;x++){const v=dataArray?dataArray[(idx+x)%bufferLength]:0;l+=v.toString(16).padStart(2,'0').toUpperCase()+" ";}ctx.fillStyle=y%2===0?"#888":"#00ffcc";ctx.fillText(l,20,y*16);idx+=16;}}
    function drawGlitch(ctx,w,h,bass){const cnt=bass*200;for(let i=0;i<cnt;i++){const x=Math.random()*w,y=Math.random()*h,c=String.fromCharCode(33+Math.floor(Math.random()*90));ctx.fillStyle=Math.random()>0.5?"#fff":"#ff3333";ctx.fillText(c,x,y);}ctx.fillStyle="#00ffcc";ctx.fillText("SYSTEM CORRUPTION...",w/2-50,h/2);}
    let sHist=[];function drawSeismograph(ctx,w,h){let avg=0;if(dataArray){for(let i=0;i<bufferLength;i++)avg+=dataArray[i];avg/=bufferLength;}sHist.push(avg);if(sHist.length>w/5)sHist.shift();ctx.fillStyle="#ff3333";for(let i=0;i<sHist.length;i++){const v=sHist[i],y=h/2+(Math.random()-0.5)*v;ctx.fillText(".",i*5,y);if(v>100)ctx.fillText("|",i*5,y);}}
    function drawCompass(ctx,w,h,bass){const cx=w/2,cy=h/2,a=Date.now()*0.001+(bass*Math.PI),len=150,ex=cx+Math.cos(a)*len,ey=cy+Math.sin(a)*len;ctx.fillStyle="#fff";ctx.fillText("N",cx,cy-170);ctx.fillText("S",cx,cy+170);ctx.fillText("E",cx+170,cy);ctx.fillText("W",cx-170,cy);for(let i=0;i<20;i++){const lx=cx+(ex-cx)*(i/20),ly=cy+(ey-cy)*(i/20);ctx.fillStyle=i>10?"#ff3333":"#fff";ctx.fillText("+",lx,ly);}}
    function drawBarcode(ctx,w,h){const bars=40,bw=w/bars;for(let i=0;i<bars;i++){const v=dataArray?dataArray[i*2]:0,th=Math.floor(v/20);ctx.fillStyle="#000";ctx.fillRect(i*bw,0,bw,h);ctx.fillStyle="#fff";for(let t=0;t<th;t++)ctx.fillText("|",i*bw+t*2,h/2);ctx.fillText(v,i*bw,h/2+20);}}
    function drawTerminal(ctx,w,h){const lines=Math.floor(h/16);for(let i=0;i<lines;i++){const v=dataArray?dataArray[i]:0,cmd=`PROC_${i*392}: [${"#".repeat(Math.floor(v/10))}] ${v}%`;ctx.fillStyle=i===10?"#fff":"#00ffcc";ctx.fillText(cmd,20,i*16);}}
    function drawHeatmap(ctx,w,h){const cols=Math.floor(w/20),rows=Math.floor(h/20);for(let y=0;y<rows;y++)for(let x=0;x<cols;x++){const idx=(x+y*cols)%bufferLength,v=dataArray?dataArray[idx]:0,c=v>200?"@":v>150?"#":v>100?"x":v>50?":":".",hue=240-(v/255*240);ctx.fillStyle=`hsl(${hue},100%,50%)`;ctx.fillText(c,x*20,y*20);}}
    let vpHist=[];function drawVoiceprint(ctx,w,h){let l=[];for(let i=0;i<64;i++)l.push(dataArray?dataArray[i*4]:0);vpHist.unshift(l);if(vpHist.length>h/10)vpHist.pop();vpHist.forEach((r,y)=>{r.forEach((v,x)=>{ctx.fillStyle=`rgba(0,255,204,${v/255})`;ctx.fillText(v>128?"█":"░",x*12+w/2-384,y*10);});});}
    function drawEQRings(ctx,w,h,bass){const cx=w/2,cy=h/2;ctx.lineWidth=5;for(let i=0;i<32;i++){const v=dataArray?dataArray[i*4]:0,r=i*10+20,e=-Math.PI/2+(v/255)*Math.PI*2;ctx.strokeStyle=`hsl(${i*10},100%,50%)`;ctx.beginPath();ctx.arc(cx,cy,r,-Math.PI/2,e);ctx.stroke();}}

    // --- UI LOGIC ---
    function log(msg, type="sys") { const d=document.createElement('div'); d.className=`log-entry ${type}`; d.textContent=msg; DOM.history.appendChild(d); DOM.history.scrollTop=DOM.history.scrollHeight; }
    
    function togglePanel() { 
        const isClosed = DOM.panel.style.display === "none" || DOM.panel.style.display === "";
        DOM.panel.style.display = isClosed ? "block" : "none";
        if (isClosed) DOM.history.classList.add('dimmed');
        else DOM.history.classList.remove('dimmed');
        DOM.input.focus();
    }
    
    function initPanel() {
        DOM.grid.innerHTML = "";
        MODES.forEach(m => {
            const btn = document.createElement('div'); btn.className = "module-btn";
            btn.textContent = `[${m.id.toString().padStart(2, '0')}] ${m.name}`;
            btn.title = m.desc;
            btn.onclick = () => { 
                STATE.mode = m.id; 
                log(`Visual: ${m.name}`, "success"); 
                initPanel();
                DOM.input.focus();
            };
            if (m.id === STATE.mode) btn.classList.add('active');
            DOM.grid.appendChild(btn);
        });
    }

    DOM.trigger.onclick = togglePanel;
    document.addEventListener('keydown', (e) => {
        if(e.key === 'Tab') { e.preventDefault(); DOM.ui.classList.toggle('hidden'); }
    });

    function playTrack(idx) {
        if (!STATE.playlist.length) return log("Error: Mount media first.", "warn");
        if (idx < 0) idx = STATE.playlist.length - 1;
        if (idx >= STATE.playlist.length) idx = 0; 
        STATE.trackIndex = idx;
        const file = STATE.playlist[idx]; initAudio();
        audioEl.src = URL.createObjectURL(file);
        
        DOM.acTitle.textContent = `${idx+1}. ${file.name}`;
        
        audioEl.play().then(() => {
            STATE.isPlaying = true; 
            log(`Playing: ${file.name}`, "success");
            DOM.trigger.style.display = "block";
            DOM.btnPlay.textContent = "PAUSE";
            DOM.btnPlay.style.color = "var(--tube-green)";
        });
    }
    
    function playNext() { playTrack(STATE.trackIndex + 1); }
    function prevTrack() { playTrack(STATE.trackIndex - 1); }

    const COMMANDS = {
        'load': () => { document.getElementById('file-input').click(); return "Mounting..."; },
        'play': () => { togglePlay(); return STATE.isPlaying ? "Resuming..." : "Holding..."; },
        'pause': () => { togglePlay(); return "Paused."; },
        'playbar': () => togglePlaybar(),
        'help': () => "CMDS: load, play, pause, playbar, [Tab]"
    };

    DOM.input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            const val = DOM.input.value.trim(); DOM.input.value = ""; if (!val) return;
            log(`USER@TYPER:~$ ${val}`);
            const args = val.split(" "); const cmd = args[0].toLowerCase();
            if (COMMANDS[cmd]) { const res = COMMANDS[cmd](args); if (res) log(res, "sys"); }
            else { log("Unknown Protocol.", "warn"); }
        }
    });
    document.getElementById('file-input').addEventListener('change', (e) => {
        STATE.playlist = Array.from(e.target.files);
        log(`Buffer: ${STATE.playlist.length} files mounted.`, "success"); playTrack(0);
        DOM.playbar.style.display = "block"; // Auto show playbar on load
    });

    initPanel(); log("TYPER OMNI CORE TUBE [ONLINE]", "sys"); render();
</script>
</body>
</html>
